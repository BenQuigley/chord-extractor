
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Welcome to chord-extractor’s documentation! &#8212; chord-extractor  documentation</title>
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="#">chord-extractor  documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Welcome to chord-extractor’s documentation!</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="module-chord_extractor">
<span id="welcome-to-chord-extractor-s-documentation"></span><h1>Welcome to chord-extractor’s documentation!<a class="headerlink" href="#module-chord_extractor" title="Permalink to this headline">¶</a></h1>
<p>Python library for extracting chord sequences from sound files of multiple formats with the option of leveraging
multiprocessing to source data from many files quickly. The extraction process wraps Chordino
(<a class="reference external" href="http://www.isophonics.net/nnls-chroma">http://www.isophonics.net/nnls-chroma</a>) but is extensible to easily incorporate additional techniques.</p>
<p>Simple usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">chord_extractor.extractors</span> <span class="kn">import</span> <span class="n">Chordino</span>

<span class="n">chordino</span> <span class="o">=</span> <span class="n">Chordino</span><span class="p">(</span><span class="n">roll_on</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Optional, only if we need to extract from a file that isn&#39;t accepted by librosa</span>
<span class="n">conversion_file_path</span> <span class="o">=</span> <span class="n">chordino</span><span class="o">.</span><span class="n">preprocess</span><span class="p">(</span><span class="s1">&#39;/some_path/some_song.mid&#39;</span><span class="p">)</span>

<span class="n">chords</span> <span class="o">=</span> <span class="n">chordino</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">conversion_file_path</span><span class="p">)</span>
</pre></div>
</div>
<p>Extract from many files with multiprocessing:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">chord_extractor.extractors</span> <span class="kn">import</span> <span class="n">Chordino</span>
<span class="kn">from</span> <span class="nn">chord_extractor</span> <span class="kn">import</span> <span class="n">clear_conversion_cache</span><span class="p">,</span> <span class="n">LabelledChordSequence</span>

<span class="n">files_to_extract_from</span> <span class="o">=</span> <span class="p">[</span>
  <span class="s1">&#39;/path/file1.mid&#39;</span><span class="p">,</span>
  <span class="s1">&#39;/path/file2.wav&#39;</span><span class="p">,</span>
  <span class="s1">&#39;/path/file3.mp3&#39;</span><span class="p">,</span>
  <span class="s1">&#39;/path/file4.ogg&#39;</span>
<span class="p">]</span>

<span class="k">def</span> <span class="nf">save_to_db_cb</span><span class="p">(</span><span class="n">results</span><span class="p">:</span> <span class="n">LabelledChordSequence</span><span class="p">):</span>
    <span class="c1"># Every time one of the files has had chords extracted, receive the chords here</span>
    <span class="c1"># along with the name of the original file and then run some logic here, e.g. to</span>
    <span class="c1"># save the latest data to DB</span>

<span class="n">chordino</span> <span class="o">=</span> <span class="n">Chordino</span><span class="p">(</span><span class="n">roll_on</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Optionally clear cache of converted files (e.g. midi files that have been converted</span>
<span class="c1"># to wav for extraction)</span>
<span class="n">clear_conversion_cache</span><span class="p">()</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">chordino</span><span class="o">.</span><span class="n">extract_many</span><span class="p">(</span><span class="n">files_to_extract_from</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">save_to_db_cb</span><span class="p">,</span> <span class="n">num_extractors</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                            <span class="n">num_preprocessors</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">max_files_in_cache</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">stop_on_error</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<dl class="py class">
<dt id="chord_extractor.ChordChange">
<em class="property">class </em><code class="sig-prename descclassname">chord_extractor.</code><code class="sig-name descname">ChordChange</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">chord</span><span class="p">:</span> <span class="n">str</span></em>, <em class="sig-param"><span class="n">timestamp</span><span class="p">:</span> <span class="n">float</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/chord_extractor/outputs.html#ChordChange"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#chord_extractor.ChordChange" title="Permalink to this definition">¶</a></dt>
<dd><p>Tuple to represent the time point in a sound file at which a chord changes and which chord it changes to.</p>
<p>The string notation used in the chord string is standard notation (and that used by Chordino). Examples include
Emaj7, Dm, Cb7, where maj = major, m = minor, b = flat etc. Note that if ‘N’ is given, this denotes no chord, e.g.
if a part of the sound file is non-musical.</p>
<dl class="py attribute">
<dt id="chord_extractor.ChordChange.chord">
<code class="sig-name descname">chord</code><em class="property">: str</em><a class="headerlink" href="#chord_extractor.ChordChange.chord" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 0</p>
</dd></dl>

<dl class="py attribute">
<dt id="chord_extractor.ChordChange.timestamp">
<code class="sig-name descname">timestamp</code><em class="property">: float</em><a class="headerlink" href="#chord_extractor.ChordChange.timestamp" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 1</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="chord_extractor.ChordExtractor">
<em class="property">class </em><code class="sig-prename descclassname">chord_extractor.</code><code class="sig-name descname">ChordExtractor</code><a class="reference internal" href="_modules/chord_extractor/base.html#ChordExtractor"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#chord_extractor.ChordExtractor" title="Permalink to this definition">¶</a></dt>
<dd><p>Abstract class for extracting chords from sound files. It also provides functionality for sound file conversion,
which can be added to by overriding .convert. This is useful as implementations using .extract
may take only certain file formats, and integrating conversion logic here enables it to be parallelized.</p>
<dl class="py method">
<dt id="chord_extractor.ChordExtractor.extract">
<em class="property">abstract </em><code class="sig-name descname">extract</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">file</span><span class="p">:</span> <span class="n">str</span></em><span class="sig-paren">)</span> &#x2192; List<span class="p">[</span>chord_extractor.outputs.ChordChange<span class="p">]</span><a class="reference internal" href="_modules/chord_extractor/base.html#ChordExtractor.extract"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#chord_extractor.ChordExtractor.extract" title="Permalink to this definition">¶</a></dt>
<dd><p>Extract chord changes from a particular file</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>file</strong> – File path to the relevant file (and if possible can accept file like object)</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>List of chord changes for the sound file</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="chord_extractor.ChordExtractor.extract_many">
<code class="sig-name descname">extract_many</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">files</span><span class="p">:</span> <span class="n">List<span class="p">[</span>str<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">callback</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>Callable<span class="p">[</span><span class="p">[</span>chord_extractor.outputs.LabelledChordSequence<span class="p">]</span><span class="p">, </span>None<span class="p">]</span><span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em>, <em class="sig-param"><span class="n">num_extractors</span><span class="p">:</span> <span class="n">int</span> <span class="o">=</span> <span class="default_value">1</span></em>, <em class="sig-param"><span class="n">num_preprocessors</span><span class="p">:</span> <span class="n">int</span> <span class="o">=</span> <span class="default_value">1</span></em>, <em class="sig-param"><span class="n">max_files_in_cache</span><span class="p">:</span> <span class="n">int</span> <span class="o">=</span> <span class="default_value">50</span></em>, <em class="sig-param"><span class="n">stop_on_error</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span> &#x2192; List<span class="p">[</span>chord_extractor.outputs.LabelledChordSequence<span class="p">]</span><a class="reference internal" href="_modules/chord_extractor/base.html#ChordExtractor.extract_many"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#chord_extractor.ChordExtractor.extract_many" title="Permalink to this definition">¶</a></dt>
<dd><p>Extract chords from a list of files. As opposed to looping over the .extract method, this one gives the option
to run many extractions in parallel. Furthermore any file conversions that have to be done as a prerequisite
to extraction can also be done in parallel with the extractions.</p>
<p>Files can be a mix of different file formats. If a file is of a format that needs to be converted in
preprocessing, the conversion will be passed to a queue for extraction. Otherwise the original file will be
queued. Any conversions are cached in a temporary folder specified using the environment variable
EXTRACTOR_TEMP_FILE_PATH (/tmp if not specified).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>files</strong> – List of paths to files we wish to extract chords for</p></li>
<li><p><strong>callback</strong> – An optional callable that is called when chords have been extracted from a particular file.
This takes a tuple with the extraction results and original filepath of the extracted file as argument.</p></li>
<li><p><strong>num_extractors</strong> – Max number of extraction processes to run in parallel</p></li>
<li><p><strong>num_preprocessors</strong> – Max number of conversion processes to run in parallel</p></li>
<li><p><strong>max_files_in_cache</strong> – Limit of number of files for a single extract_many run to have in the temporary file
cache (for file conversions) at any one time. If 0, there is no limit and no conversions will be deleted,
otherwise conversions are deleted once extractions are performed (extractions are paused if the file limit
is reached).</p></li>
<li><p><strong>stop_on_error</strong> – If True, an error encountered during a single extraction will stop the overall
extraction multiprocessing, else an error will cause a None result to be returned for a particular input file.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>List of tuples, each with the extraction results and original filepath</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="chord_extractor.ChordExtractor.preprocess">
<code class="sig-name descname">preprocess</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">path</span><span class="p">:</span> <span class="n">str</span></em><span class="sig-paren">)</span> &#x2192; Optional<span class="p">[</span>str<span class="p">]</span><a class="reference internal" href="_modules/chord_extractor/base.html#ChordExtractor.preprocess"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#chord_extractor.ChordExtractor.preprocess" title="Permalink to this definition">¶</a></dt>
<dd><p>Run any preprocessing steps based on the location path of the sound file provided. Primarily this is used to
convert the file at the path, based on its file extension to a file usable by the extract method. However, an
override of this method can perform any logic that may benefit from multiprocessing available in extract_many.</p>
<p>In this implementation any midi files are converted to wav files which are placed in a temporary directory
(conversion cache).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>path</strong> – Path to the file</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Return file path to output file of conversion if conversion has happened, else None</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="chord_extractor.LabelledChordSequence">
<em class="property">class </em><code class="sig-prename descclassname">chord_extractor.</code><code class="sig-name descname">LabelledChordSequence</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">id</span><span class="p">:</span> <span class="n">str</span></em>, <em class="sig-param"><span class="n">sequence</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>List<span class="p">[</span>chord_extractor.outputs.ChordChange<span class="p">]</span><span class="p">]</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/chord_extractor/outputs.html#LabelledChordSequence"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#chord_extractor.LabelledChordSequence" title="Permalink to this definition">¶</a></dt>
<dd><p>Output of chord extractions with identifier, suitable for when running using asynchronous processes. The
sequence may be None if no result was returned for that particular id.</p>
<dl class="py attribute">
<dt id="chord_extractor.LabelledChordSequence.id">
<code class="sig-name descname">id</code><em class="property">: str</em><a class="headerlink" href="#chord_extractor.LabelledChordSequence.id" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 0</p>
</dd></dl>

<dl class="py attribute">
<dt id="chord_extractor.LabelledChordSequence.sequence">
<code class="sig-name descname">sequence</code><em class="property">: Optional<span class="p">[</span>List<span class="p">[</span>chord_extractor.outputs.ChordChange<span class="p">]</span><span class="p">]</span></em><a class="headerlink" href="#chord_extractor.LabelledChordSequence.sequence" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 1</p>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt id="chord_extractor.clear_conversion_cache">
<code class="sig-prename descclassname">chord_extractor.</code><code class="sig-name descname">clear_conversion_cache</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/chord_extractor/base.html#clear_conversion_cache"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#chord_extractor.clear_conversion_cache" title="Permalink to this definition">¶</a></dt>
<dd><p>Clear the temporary directory containing sound file conversions</p>
</dd></dl>

<div class="section" id="extractors">
<h2>Extractors<a class="headerlink" href="#extractors" title="Permalink to this headline">¶</a></h2>
<div class="toctree-wrapper compound">
</div>
</div>
</div>
<div class="section" id="indices-and-tables">
<h1>Indices and tables<a class="headerlink" href="#indices-and-tables" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><p><a class="reference internal" href="genindex.html"><span class="std std-ref">Index</span></a></p></li>
<li><p><a class="reference internal" href="py-modindex.html"><span class="std std-ref">Module Index</span></a></p></li>
<li><p><a class="reference internal" href="search.html"><span class="std std-ref">Search Page</span></a></p></li>
</ul>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="#">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Welcome to chord-extractor’s documentation!</a><ul>
<li><a class="reference internal" href="#extractors">Extractors</a></li>
</ul>
</li>
<li><a class="reference internal" href="#indices-and-tables">Indices and tables</a></li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/index.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="#">chord-extractor  documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Welcome to chord-extractor’s documentation!</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2021, Oliver Holloway.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.4.3.
    </div>
  </body>
</html>